<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>巡检情况查询</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/people_info.css">
</head>
<body>
<nav class="navbar-my col-lg-12 col-md-12 col-xs-12 col-sm-12">
    <img class="logo-img" src="images/logo.png" alt="logo">
    <div class="navbar-header-my navbar-header ">
        <span class="logo">派出所住户地址登记查询系统</span>
    </div>

    <div class="logout" >
        <p class="navbar-icon navbar-text navbar-right text-right">
            <a href="index.html" class="navbar-link"><span class="icomoon">&#xe900;</span></a>
            <a href="#" class="navbar-link"><span class="icomoon">&#xe905;</span></a>
            <a href="#" class="navbar-link"><span class="icomoon">&#xe908;</span></a>
            <a href="login.html" class="navbar-link"><span class="icomoon">&#xe90b;</span></a>
        </p>
        <div id="admin" class="admin pull-right"></div>
    </div><!-- /.navbar-collapse -->
</nav>

<div class="main2">
    <div class="col-lg-8 col-md-8 col-lg-offset-2 col-md-offset-2">
        <div class="plot">
            <div id="plot" class="plot-chart col-lg-5 col-md-5"></div>
            <div id="plot-info" class="plot-info col-lg-7 col-md-7">
                <ul class="plot-check-log list-unstyled" id="comm-overdue">
                    <!-- <li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span>小区名称</li> -->
                </ul>

            </div>
        </div>
        <div class="building">
            <div id="building" class="building-chart col-lg-5 col-md-5"></div>
            <div id="building-info" class="building-info col-lg-7 col-md-7">
                <ul class="building-check-log list-unstyled" id="build-overdue">
                    <!-- <li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span>楼宇名称</li> -->
                </ul>
            </div>

        </div>
        <div class="house-c">
            <div id="house-c" class="house-chart col-lg-5 col-md-5"></div>
            <div class="house-c-info col-lg-7 col-md-7">
                <ul class="house-check-log list-unstyled" id="room-overdue">
                    <!-- <li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span>房间信息</li> -->
                </ul>
            </div>
        </div>
    </div>
</div>

</body>
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/main.js"></script>
<script src="js/police.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var datas = JSON.parse(storage.getItem('police-info'));
        var poli_id_my = datas.police.poliId;
        admin();

        getOverDueCom(poli_id_my);


        
    });

function getOverDueCom(poli_id_my){
    $.ajax({
        url: '../overInfo/OverDate',
        type: 'POST',
        data: {
            poli_id: poli_id_my,
        },
        success:function(data){
            // console.log(data);
            var datas = eval('('+data+')');

            commchart(datas);
            buildchart(datas);
            roomchart(datas);

            commlist(datas);
            buildlist(datas);
            roomlist(datas);
            
        },
        error:function(err){
        alert('发生了错误：'+err.status);
        console.table(err);
        }
    });
}
function commchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_community_number, name:'未巡检小区'});
    chart_data.push({value:datas.community_number-datas.over_due_community_number, name:'已巡检小区'});
        
    creatCharts('plot',chart_data,'小区巡检情况:');
}

function buildchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_building_number, name:'未巡检建筑'});
    chart_data.push({value:datas.building_number-datas.over_due_building_number, name:'已巡检建筑'});

    creatCharts('building',chart_data,'建筑巡检情况:');
}

function roomchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_room_num, name:'未巡检房间'});
    chart_data.push({value:datas.over_room_num-datas.over_due_room_num, name:'已巡检房间'});

    creatCharts('house-c',chart_data,'房间巡检情况:');
}

function commlist(datas){
    var commbox = $('#comm-overdue');
    commbox.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_community.length; i++) {

        getCommName(datas.over_due_community[i].commId,i);

        p += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue'+i+'"></span></li>'
    }

    commbox.prepend(p);
}
function buildlist(datas){
    var buildbox = $('#build-overdue');
    buildbox.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_building.length; i++) {

        getCommName(datas.over_due_building[i].commId,-i-1);
        getBuildName(datas.over_due_building[i].builId,i);

        p += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue'+(-i-1)+'"></span>&nbsp;&nbsp;'+datas.over_due_building[i].builName+'</li>'
    }

    buildbox.prepend(p);
}
function roomlist(datas){
    var roombox = $('#room-overdue');
    roombox.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_room.length; i++) {

        getBuildName(datas.over_due_room[i].builId,i);

        p += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue'+('-'+i+'-'+i)+'"></span>&nbsp;&nbsp;<span id="builName-overdue'+i+'"></span>&nbsp;&nbsp;'+datas.over_due_room[i].roomUnit+'单元&nbsp;&nbsp;'+datas.over_due_room[i].roomNo+'</li>'
    }

    roombox.prepend(p);
}
</script>
</html>