package edu.hdu.lab.checkIn.controllers;

import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import edu.hdu.lab.checkIn.mapper.InspectLogMapper;
import edu.hdu.lab.checkIn.mapper.PersonMapper;
import edu.hdu.lab.checkIn.model.InspectLog;
import edu.hdu.lab.checkIn.model.Person;
import edu.hdu.lab.checkIn.utils.DateUtils;
import edu.hdu.lab.checkIn.utils.JsonUtils;

@Controller
public class InspectLogController {

	private Logger logger = Logger.getLogger(getClass());

	@Autowired
	private PersonMapper personMapper;
	
	@Autowired
	private InspectLogMapper inspectLogMapper;

//	@ResponseBody
//	@RequestMapping(value = "/inspectLog/getInsp", method = RequestMethod.POST, produces = "text/html;charset=UTF-8")
//	public String getPersInfobyPersid(@RequestParam("pers_id") Integer pers_id,
//			HttpServletRequest request) {
//		Person person = personMapper.selectByPrimaryKey(pers_id);
//		int resultCode = 0;
//		Map<String, Object> resultMap = new HashMap<String, Object>(2);
//		if (person != null) {
//			resultCode=1;
//			resultMap.put("person", person);
//		}
//		resultMap.put("resultCode", resultCode);
//		return JsonUtils.createGson().toJson(resultMap);
//	}
	
	@ResponseBody
	@RequestMapping(value = "/inspectLog/addInsp", method = RequestMethod.POST, produces = "text/html;charset=UTF-8")
	public String addPers(@RequestParam(value = "inspRec", required = false) String inspRec,
			@RequestParam(value = "inspTime", required = false) String inspTime,
			@RequestParam(value = "poliId", required = false) Integer poliId,
			@RequestParam(value = "ramark", required = false) String ramark,
			@RequestParam(value = "roomId", required = true) Integer roomId,
			HttpServletRequest request) {
		InspectLog inspectLog = new InspectLog();
		inspectLog.setInspRec(inspRec);
		inspectLog.setInspTime(DateUtils.StringtoDate(inspTime));
		inspectLog.setPoliId(poliId);
		inspectLog.setRamark(ramark);
		inspectLog.setRoomId(roomId);
		
		int resultCode = 0;
		Map<String, Object> resultMap = new HashMap<String, Object>(2);
		resultCode = inspectLogMapper.insert(inspectLog);
		resultMap.put("resultCode", resultCode);
		return JsonUtils.createGson().toJson(resultMap);
	}

}
