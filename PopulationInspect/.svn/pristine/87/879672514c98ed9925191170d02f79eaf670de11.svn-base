//所长二级目录请求数据---派出所-->小区/独立建筑
function treeLevel20(stat_id_my){
	$.ajax({
		url:'../police_station/jurisdiction',
		type:'POST',
		data:{
			poli_station_id:stat_id_my,
		},
		success:function(data){
		 //console.log(data);
			var tree_datas = eval('('+data+')');
			var buildingbox = $('#menu1-ul');
		    buildingbox.html('');
		   
		    var p = '';
		    for (var i = 0; i < tree_datas.community.length; i++) {
		        p += '<li class="building1" id="commId'+tree_datas.community[i].commId+'" ><a class="m0" href="javascript:void(0)" onclick="treeLevel21(' + tree_datas.community[i].commId + ','+'\''+tree_datas.community[i].commName+'\''+');createJurisdection('+'\''+tree_datas.community[i].commGpslist+'\''+');getStatisByComm('+tree_datas.community[i].commId+');return false;">'+tree_datas.community[i].commName+'</a><ul class="file" id="file'+tree_datas.community[i].commId+'"></ul></li>';
		        
		    }
		    for (var j = 0; j < tree_datas.building.length; j++) {
		        p += '<li class="building2" id="building'+tree_datas.building[j].builId+'"><a class="m1" href="javascript:void(0)" onclick="getStatisBybuild('+tree_datas.building[j].builId+ ');breadBuild('+'\''+tree_datas.building[j].builName+'\''+');createBuiding('+tree_datas.building[j].builGpse+','+tree_datas.building[j].builGpsn+','+tree_datas.building[j].builId+','+'\''+tree_datas.building[j].builName+'\''+')">'+tree_datas.building[j].builName+'</a></li>';
		        
		    }

		    p += '</ul>';

		    buildingbox.append(p);

		    buildingbox.toggle();

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//三级目录请求数据----小区-->建筑
function treeLevel21(Comm_id_my,name){
	 //标头添加小区
	var breadcrumb1 = $("#breadcrumb1");
	var root1 = $("#root1");
	root1.nextAll().remove();
	var root2 = '<li id="root2" ><a href="#">' + name + '</a></li>';
	breadcrumb1.append(root2);
	$.ajax({
		url:'../community/building',
		type:'POST',
		data:{
			comm_id:Comm_id_my,
		},
		success:function(data){
			//console.log(data);
			var datas = eval('('+data+')');
			// console.log(nodeId_my);
			
		    var buildingbox = $('#file'+Comm_id_my);
		    buildingbox.html('');
		    var p = '';
		    for (var i = 0; i < datas.building.length; i++) {
		        p += '<li class="building2" id="building'+datas.building[i].builId+'"><a href="javascript:void(0)" onclick="getStatisBybuild('+datas.building[i].builId+');breadBuild('+'\''+datas.building[i].builName+'\''+');createBuiding('+datas.building[i].builGpse+','+datas.building[i].builGpsn+','+datas.building[i].builId+','+'\''+datas.building[i].builName+'\''+')">'+datas.building[i].builName+'</a></li>';
		    }

		    buildingbox.prepend(p);

		    buildingbox.toggle();
			
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//一般警员一级目录数据请求---辖区建筑-->小区/独立建筑
function treeLevel10(poli_id_my,name){

	$.ajax({
		url:'../police/jurisdiction',
		type:'POST',
		data:{
			poli_id:poli_id_my,
		},
		success:function(data){
		// console.log(data);
			var tree_datas = eval('('+data+')');

			var buildingbox = $('#menu1-ul');
		    buildingbox.html('');
		    var p = '';
		    for (var i = 0; i < tree_datas.community.length; i++) {
		        p += '<li class="building1" id="commId'+tree_datas.community[i].commId+'" ><a class="m0" href="javascript:void(0)" onclick="treeLevel21(' + tree_datas.community[i].commId + ','+'\''+tree_datas.community[i].commName+'\''+');getStatisByComm('+tree_datas.community[i].commId+');createJurisdection('+'\''+tree_datas.community[i].commGpslist+'\''+');return false;">'+tree_datas.community[i].commName+'</a><ul class="file" id="file'+tree_datas.community[i].commId+'"></ul></li>';
		        
		    }
		    for (var j = 0; j < tree_datas.building.length; j++) {
		        p += '<li class="building2" id="building'+tree_datas.building[j].builId+'"><a class="m1" href="javascript:void(0)" onclick="getStatisBybuild('+tree_datas.building[j].builId+');breadBuild1('+'\''+tree_datas.building[j].builName+'\''+');createBuiding('+tree_datas.building[j].builGpse+','+tree_datas.building[j].builGpsn+','+tree_datas.building[j].builId+','+'\''+tree_datas.building[j].builName+'\''+')">'+tree_datas.building[j].builName+'</a></li>';
		    }

		    p += '</ul>';

		    buildingbox.append(p);

		    buildingbox.toggle();

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//警员二级目录数据请求----点击小区获取建筑
//调用treelevel20();
//统计信息---警员登录时加载全部统计信息
function getStatisByPoli(poli_id_my){
	$.ajax({
		url:'../police/jurisdiction/statistics',
		type:'POST',
		data:{
			poli_id:poli_id_my,
		},
		success:function(data){
		 //console.log(data);
			var datas = eval('('+data+')');
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> 所管辖区</li>'
			p += '<ul><li>小区数：'+datas.community_number+'</li><li>超期未巡检小区数：'+datas.over_due_community_number+'</li><li>重点关注小区数：'+datas.focus_community_number+'</li></ul>';
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数：'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);
			
			$('.charts').css({'display':'none'});
			commchart2(datas);
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//点击小区时，显示小区统计信息
function getStatisByComm(comm_id_my){
	var commName = $('#commId'+comm_id_my+">:first-child").text();
	$.ajax({
		url:'../community/statistics',
		type:'POST',
		data:{
			comm_id:comm_id_my,
		},
		success:function(data){
		 //console.log(data);
			var datas = eval('('+data+')');
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span>'+commName+'</li>'
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数：'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);
			$('.charts').css({'display':'none'});
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//点击建筑 获取建筑统计信息
function getStatisBybuild(buil_id_my){
	var builName = $('#building'+buil_id_my+">:first-child").text();
	$.ajax({
		url:'../building/statistics',
		type:'POST',
		data:{
			buil_id:buil_id_my,
		},
		success:function(data){
			var datas = eval('('+data+')');
			//console.log(datas);
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> '+builName+'</li>'
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数：'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);
			$('.charts').css({'display':'none'});
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//所长
function commchart(datas){
	//console.log(datas);
	var chart_data_comm = [];
	chart_data_comm.push({value:datas.indebuilding,name:'独立建筑'},
						{value:datas.building_number-datas.indebuilding,name:'小区建筑'});

	$('#chart1').css({display: 'block'});

	creatCharts('chart1',chart_data_comm,'楼宇/建筑统计:');
}
//一般警员
function commchart2(datas){
	//console.log(datas);
	var chart_data_comm = [];
	chart_data_comm.push({value:datas.indebuliding_number,name:'独立建筑'},
						{value:datas.building_number-datas.indebuliding_number,name:'小区建筑'});

	$('#chart1').css({display: 'block'});

	creatCharts('chart1',chart_data_comm,'楼宇/建筑统计:');
}

//统计信息---所长登录时加载全部统计信息
function getStatisByStat(stat_id_my){
	$.ajax({
		url:'../police_station/jurisdiction/statistics',
		type:'POST',
		data:{
			poli_station_id:stat_id_my,
		},
		success:function(data){
			var datas = eval('('+data+')');
			console.log(datas);
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> 派出所辖区</li>'
			p += '<ul><li>警员数：'+datas.police_number+'</li></ul>'
			p += '<ul><li>小区数：'+datas.community_number+'</li><li>超期未巡检小区数：'+datas.over_due_community_number+'</li><li>重点关注小区数：'+datas.focus_community_number+'</li></ul>';
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数：'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);

			$('.charts').css({'display':'none'});
			commchart(datas);
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//房间分类统计
function roomchart(datas){
	var chart_data_room = [];
	for (var i = 0; i < datas.room_classify_info.length; i++) {
		if(datas.room_classify_info[i].roomclass==01){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'住宅'}) ;	
		}else if(datas.room_classify_info[i].roomclass==02){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'特业'});
		}else if(datas.room_classify_info[i].roomclass==03){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'学校'});
		}else if(datas.room_classify_info[i].roomclass==04){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'场所'});
		}else if(datas.room_classify_info[i].roomclass==05){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'其他'});
		}else if(datas.room_classify_info[i].roomclass==06){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'重点关注'});
		}else{
			alert('数据有误！');
		}
		
	}
	$('#chart2').css({display: 'block'});

	creatCharts('chart2',chart_data_room,'房间分类统计:');
}
//人员居住原因统计
function peoplechart(datas){
	var chart_data_people = [];
	for (var i = 0; i < datas.person_classify_info.length; i++) {
		if (datas.person_classify_info[i].why==01) {
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'自住'});
		}else if (datas.person_classify_info[i].why==02) {
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'租住'});
		}else if (datas.person_classify_info[i].why==03){
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'工作'});
		}else{
			alert('数据有误！');
		}
	}
	$('#chart3').css({display: 'block'});

	creatCharts('chart3',chart_data_people,'人员居住原因统计:');
}

// 面包屑导航 --->建筑
function breadBuild(name){
	var breadcrumb1 = $("#breadcrumb1");
	var root2 = $("#root2");
	root2.nextAll().remove();
	var root3 = '<li id="root3" ><a href="#">' + name + '</a></li>';
	breadcrumb1.append(root3);
}
//独立建筑面包屑导航
function breadBuild1(name){
	var breadcrumb1 = $("#breadcrumb1");
	var root1 = $("#root1");
	root1.nextAll().remove();
	var root3 = '<li id="root3" ><a href="#">' + name + '</a></li>';
	breadcrumb1.append(root3);
}

//点击建筑获取单元信息
function getUnit(buil_id_my){
	$.ajax({
		url:'../building/unit',
		type:'POST',
		data:{
			buil_id:buil_id_my,
		},
		success:function(data){
			console.log(data);
			var datas = eval('('+data+')');

			var tabbox = $('#myTab');
			tabbox.html('');
			if(datas.unit.length){
				var p = '<li class="active"><a class="tab-d" onclick="hideRoomInfo();getfloor('+buil_id_my+','+datas.unit[0]+');" href="javascript:void(0)" data-toggle="tab">' + datas.unit[0] + '单元</a></li>';
			    for (var i = 1; i < datas.unit.length; i++) {
			        p += '<li><a class="tab-d" onclick="hideRoomInfo();getfloor('+buil_id_my+','+datas.unit[i]+');" href="javascript:void(0)" data-toggle="tab">' + datas.unit[i] + '单元</a></li>';

		    	}

		    	tabbox.prepend(p);
		    	getfloor(buil_id_my,datas.unit[0]);

			}else{
				tabbox.prepend('没有单元信息');
			}
		    
		    
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
// 根据建筑和单元 获取楼层信息
function getfloor(builId,unit){
	$.ajax({
		url:'../building/unit/floor',
		type:'POST',
		data:{
			buil_id:builId,
			unit_num:unit,
		},
		success:function(data){
			console.log(data);
			var datas = eval('('+data+')');
			var floor_change = $('#floor-change');
			floor_change.html('');
			var p = '';
			p += '<li class="previous"><a id="lastfl" href="javascript:void(0)"><img src="images/lastfloor.png" alt="上"></a></li>';
			p += '<li class="floor-num"><span class="orange-2">第</span>&nbsp;&nbsp;<input class="floor-input" type="text" class="form-control input-sm" id="floor-num" placeholder="楼层" >&nbsp;&nbsp;<span class="orange-2">层</span>';
			p += '&nbsp;&nbsp;<a id="fl-go" class="btn btn-xs" href="javascript:void(0)"><img class="btn-go" src="images/btn-go.png" style="width:20px;height:20px;line-height:20px;margin-bottom:5px;" alt="跳转"></a><span class="maxfloor orange-2">（共'+datas.floor[datas.floor.length-1]+'层）</span></li>';
			p += '<li class="next"><a id="nextfl" href="javascript:void(0)"><img src="images/nextfloor.png" alt="下"></a></li>';

			floor_change.prepend(p);

			getroom(builId,unit,datas.floor[0]);

			$("#lastfl").bind("click", function(){
				lastFloor(builId,unit,datas);
			});
			$("#fl-go").bind("click", function(){
				gotoFloor(builId,unit,datas);
			});
			$("#nextfl").bind("click", function(){
				nextFloor(builId,unit,datas);
			});
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//点击单元 获取楼层及房间信息
function getroom(builId,unit_num,floor_num){
	$.ajax({
		url:'../building/unit/floor/room',
		type:'POST',
		data:{
			buil_id:builId,
			unit_num:unit_num,
			floor_num:floor_num,
		},
		success:function(data){
		//console.log(data);
		storage.setItem('room-info',data);
		var datas = eval('('+data+')');
		var roombox = $('#roombox');
		var q = '';
		roombox.html('');

		for (var i = 0; i < datas.room.length; i++) {
			// 有人 未超期 关注
        	if(datas.room[i].roomStatis.personNum>0 &&!(datas.room[i].roomStatis.isOverDue) && datas.room[i].isFocus){
            	q += '<button onclick="showRoomInfo('+i+');getPersonInfo('+datas.room[i].roomId+');houseShow();" type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-danger">'+datas.room[i].roomStatis.personNum+'<span class="badge-my badge-danger">'+datas.room[i].roomNo+'</span></button>';
			}
			//有人 未超期 不关注
			else if(datas.room[i].roomStatis.personNum>0 &&!(datas.room[i].roomStatis.isOverDue) && !(datas.room[i].isFocus)){

            	q += '<button onclick="showRoomInfo('+i+');getPersonInfo('+datas.room[i].roomId+');houseShow();" type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-success">'+datas.room[i].roomStatis.personNum+'<span class="badge-my badge-success">'+datas.room[i].roomNo+'</span></button>';
			}
	        //有人 超期 关注
	        else if(datas.room[i].roomStatis.personNum>0 &&datas.room[i].roomStatis.isOverDue && datas.room[i].isFocus){
	            q += '<button onclick="showRoomInfo('+i+');getPersonInfo('+datas.room[i].roomId+');houseShow();" type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-danger">'+datas.room[i].roomStatis.personNum+'<span class="badge-my">'+datas.room[i].roomNo+'</span></button>';
			}
	        //有人 超期 不关注
	        else if(datas.room[i].roomStatis.personNum>0 &&!datas.room[i].roomStatis.isOverDue && !(datas.room[i].isFocus)){
				q += '<button onclick="showRoomInfo('+i+');getPersonInfo('+datas.room[i].roomId+');houseShow();" type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-success">'+datas.room[i].roomStatis.personNum+'<span class="badge-my">'+datas.room[i].roomNo+'</span></button>';
	        }
	        // 没人
	        else if(datas.room[i].roomStatis.personNum==0){
				q += '<button onclick="showRoomInfo('+i+');getPersonInfo('+datas.room[i].roomId+');houseShow();" type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-default">'+datas.room[i].roomStatis.personNum+'<span class="badge-my badge-success">'+datas.room[i].roomNo+'</span></button>';
			}
				
		}
		
		q += '</p>';

    	roombox.prepend(q);

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
function houseShow(){
	$('#house-info').css({"display":"block"});
	$('.people-info').css({"display":"block"});
}

// 切换到下一层

function floorindatasA(flnow,datas){
	for(var i = 0;i<datas.floor.length;i++){
		if(flnow==datas.floor[i]){
			return i;
		}
		else if(flnow<datas.floor[i]){
			return i;
		}
	}
}
// 切换到上一层
function floorindatasR(flnow,datas){
	for(var i = datas.floor.length-1;i>=0;i--){
		if(flnow==datas.floor[i]){
			return i;
		}
		else if(flnow>datas.floor[i]){
			return i;
		}
	}
}

function lastFloor(builId,unit,datas){
	var flnow_my = $('#floor-num').val();
	var i = 0;
	flnow_my--;
	if(datas.floor[0]<=flnow_my){
		i = floorindatasR(flnow_my,datas);

		$('#floor-num').val(datas.floor[i]);

		getroom(builId,unit,datas.floor[i]);
		
	}else{
		alert("楼层不存在！");
	}
}
// 切换到下一层
function nextFloor(builId,unit,datas){
	var flnow_my = $('#floor-num').val();
	var i = 0;
	flnow_my++;
	if(datas.floor[datas.floor.length-1]>=flnow_my){
		//console.log(flnow_my);
		i = floorindatasA(flnow_my,datas);
		//console.log(i);
		$('#floor-num').val(datas.floor[i]);

		getroom(builId,unit,datas.floor[i]);
		
	}else{
		alert("楼层不存在！");
	}
}
// 切换到指定楼层
function gotoFloor(builId,unit,datas){
	var flnow_my = $('#floor-num').val();
	var i = 0;
	if(datas.floor[datas.floor.length-1]>=flnow_my&&datas.floor[0]<=flnow_my){

		i = floorindatasA(flnow_my,datas);

		$('#floor-num').val(datas.floor[i]);

		getroom(builId,unit,datas.floor[i]);
		
	}else{
		alert("楼层不存在！");
	}
}
// 点击单元隐藏房间和人员信息
function hideRoomInfo(){
	$('#house-info').css({'display': 'none'});
	$('.people-info').css({'display': 'none'});
}
//房间信息展示
function showRoomInfo(i){
	var datas = JSON.parse(storage.getItem('room-info'));
	var roomclass = '',
		roomSubclass = '',
		idFocus = '';
	var statName = $('#root1 > a').html();
	if($('#root2 > a').html()){
		var unitName = $('#root2 > a').html();
	}else{
		var unitName = '';
	}
	
	var buildName = $('#root3 > a').html();
	console.log(datas);
	// $('#house-info-c-b').html(datas.room[i].builId);
	$('#house-info-c-b').html(statName+'&nbsp;'+unitName+'&nbsp;'+buildName);
	$('#house-info-u').html(datas.room[i].roomUnit);
	$('#house-info-f').html(datas.room[i].roomFloor);
	$('#house-info-n').html(datas.room[i].roomNo);
	   //添加人员
	var peopleAdd = $("#peopleAdd");
	peopleAdd.click(function(){
		showTime(datas.room[i].roomId,datas.room[i].roomNo);
		console.log(datas.room[i].roomNo);
		
	});
	//自动巡检事件
	
	var autoInspection = $("#autoInspection");
	var dataPolices = JSON.parse(storage.getItem('police-info'));
	var policeId = dataPolices.police.poliId;
	var roomId = datas.room[i].roomId;
	autoInspection.click(function(){
		autoInspection11(policeId,roomId);
	});
	
	// 手动巡检事件
	
	var manualInspection = $("#manualInspection");
	manualInspection.click(function(){
		console.log(policeId,roomId);
		showTime1(policeId,roomId);
	});
	
	
	if(datas.room[i].roomClass=="01"){
		roomclass = '住宅';
		if (datas.room[i].roomSubclass=="0101") {
			roomSubclass = '自住住宅';
		}else if (datas.room[i].roomSubclass=="0102") {
			roomSubclass = '出租住宅';
		}else{
			roomSubclass = '未知';
		} 
	}else if(datas.room[i].roomClass=="02"){
		roomclass = '特业';
		if (datas.room[i].roomSubclass=="0201") {
			roomSubclass = '旅馆';
		}else if (datas.room[i].roomSubclass=="0202") {
			roomSubclass = '网吧';
		}else if (datas.room[i].roomSubclass=="0203") {
			roomSubclass = '废旧金属回收';
		}else if (datas.room[i].roomSubclass=="0204") {
			roomSubclass = '刻字刻章';
		}else if (datas.room[i].roomSubclass=="0205") {
			roomSubclass = '典当';
		}else{
			roomSubclass = '未知';
		}
	}else if(datas.room[i].roomClass=="03"){
		roomclass = '学校';
		if (datas.room[i].roomSubclass=="0301") {
			roomSubclass = '幼儿园';
		}else if (datas.room[i].roomSubclass=="0302") {
			roomSubclass = '中小学';
		}else if (datas.room[i].roomSubclass=="0303") {
			roomSubclass = '学生宿舍';
		}else{
			roomSubclass = '未知';
		} 
	}else if(datas.room[i].roomClass=="04"){
		roomclass = '场所';
		if (datas.room[i].roomSubclass=="0401") {
			roomSubclass = '足浴';
		}else if (datas.room[i].roomSubclass=="0402") {
			roomSubclass = '棋牌';
		}else if (datas.room[i].roomSubclass=="0403") {
			roomSubclass = 'KTV';
		}else{
			roomSubclass = '未知';
		} 
	}else if(datas.room[i].roomClass=="05"){
		roomclass = '其他';
		if (datas.room[i].roomSubclass=="0501") {
			roomSubclass = '农贸市场';
		}else if (datas.room[i].roomSubclass=="0502") {
			roomSubclass = '基督教堂';
		}else if (datas.room[i].roomSubclass=="0503") {
			roomSubclass = '其他';
		}else{
			roomSubclass = '未知';
		} 
	}else if(datas.room[i].roomClass=="06"){
		roomclass = '重点关注';
		if (datas.room[i].roomSubclass=="0601") {
			roomSubclass = '一级';
		}else if (datas.room[i].roomSubclass=="0602") {
			roomSubclass = '二级';
		}else if (datas.room[i].roomSubclass=="0603") {
			roomSubclass = '三级';
		}else{
			roomSubclass = '未知';
		} 
	}else{
		roomclass = '未知';
	}

	$('#house-info-cl').html(roomclass);
	$('#house-info-scl').html(roomSubclass);
	$('#due-num').html(datas.room[i].countInspect);
	$('#due-time').html(datas.room[i].timeLastinspect);

	var checkInfoLa = '<a href="javascript:void(0)"data-toggle="modal" data-target="#check-info" onclick="showCheckInfo('+'\''+datas.room[i].recLastinspect+'\''+')">点击查看</a>';
	if(datas.room[i].recLastinspect){
		$('#due-last').html(checkInfoLa);
	}else{
		$('#due-last').html('未找到');
	}
	
	if (datas.room[i].isFocus==true) {
		isFocus = '是';
	} else {
		isFocus = '否';
	}
	$('#house-focus').html(isFocus);
	
}
//房间上一次巡检记录
function showCheckInfo(datas){
    if(datas&&datas!='undefined'){
        $('#check-i').html(datas);
    }else{
        $('#check-i').html('记录为空！');
    }
    
}

function getPersonInfo(room_id){
	$.ajax({
		url:'../room/person',
		type:'POST',
		data:{
			room_id:room_id,
		},
		success:function(data){
			console.log(data);
			var datas = eval('('+data+')');
			var peoplebox = $('#people-info');
			peoplebox.html('');
          
			
		    var p = '';
		    for (var i = 0; i < datas.length; i++) {
		    	
		    	
		    	p += '<div class="media people-info-sub">';
		        p += '<a class="pull-left" href="javascript:void(0)"><img class="media-object" src="images/user.jpg" alt="媒体对象"></a>';
		        p += '<div class="media-body">';
		        p += '<span class="col-lg-3 col-md-3 col-xs-3 col-sm-3 name blue">'+datas[i].persName+'</span>';
		        if(datas[i].persSex){
		        	p += '<span class="col-lg-1 col-md-1 col-xs-1 col-sm-1 sex blue">男</span>'
		        }else{
		        	p += '<span class="col-lg-1 col-md-1 col-xs-1 col-sm-1 sex blue">女</span>'
		        }
		        p += '<span class="col-lg-8 col-md-8 col-xs-8 col-sm-8 id-num">'+datas[i].persIdcard+'</span>';
		        p += '<span class="col-lg-2 col-md-2 col-xs-2 col-sm-2 h"><img src="images/phone.png" alt=""></span>';
		        p += '<span class="col-lg-7 col-md-7 col-xs-7 col-sm-7 tel num h orange">'+datas[i].persPhone+'</span>';
		        if (datas[i].isFocus){
		        	p += '<span class="col-lg-3 col-md-3 col-xs-3 col-sm-3 red h">重点关注</span>';
		        } else {
		        	p += '<span class="col-lg-3 col-md-3 col-xs-3 col-sm-3 green h">非重点关注</span>';
		        }

		        if(datas[i].timeRegister){
		        	p += '<span class="col-lg-6 col-md-6 col-xs-6 col-sm-6 time gray">登记时间：'+datas[i].timeRegister.substr(0,10)+'</span>';
		        }else{
		        	p += '<span class="col-lg-6 col-md-6 col-xs-6 col-sm-6 time gray">登记时间：未知</span>';
		        }
		        
		        if (datas.whyRegister==01) {
		        	p += '<span class="col-lg-3 col-md-2 col-xs-2 col-sm-2 ident blue">自住</span>';
		        } else if (datas.whyRegister==02){
		        	p += '<span class="col-lg-3 col-md-2 col-xs-2 col-sm-2 ident blue">租住</span>';
		        }else{
		        	p += '<span class="col-lg-3 col-md-2 col-xs-2 col-sm-2 ident blue">工作</span>';
		        }
		        ///
		        //
		        //跳转页面的同时绑定人员idpeople_info.html
		        var root2 = $("#house-info-n").text();
		        p += '<a  href="people_info.html?persId='+datas[i].persId+'&room='+root2+'"  target="_blank" class="pull-right btn btn-xs btn-info col-lg-3 col-md-3 col-xs-3 col-sm-3">详情</a>';

		        p += '</div></div>'
		    }

		    peoplebox.prepend(p);
		    
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//根据房间分类/子类返回建筑列表
function getBuildByroomClass(poli_id_my,roomClass,roomSubclass){
	$.ajax({
		url: '../building/roomClass',
		type: 'post',
		data: {
			poli_id: poli_id_my,
			roomClass:roomClass,
			roomsubClass:roomsubClass,
		},
		success:function(data){
			console.log(data);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
	
}
