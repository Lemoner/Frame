package edu.hdu.lab.checkIn.controllers;

import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

import javax.servlet.http.HttpServletRequest;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import edu.hdu.lab.checkIn.dto.PoliceBasic;
import edu.hdu.lab.checkIn.model.Police;
import edu.hdu.lab.checkIn.services.PoliceService;
import edu.hdu.lab.checkIn.utils.JsonUtils;

@Controller
public class PoliceController {

	private Logger logger = Logger.getLogger(getClass());

	@Autowired
	private PoliceService policeService;

	@ResponseBody
	@RequestMapping(value = "/police/login", method = RequestMethod.POST, produces = "text/html;charset=UTF-8")
	public String authorize(@RequestParam("poli_code") String poli_code,
			HttpServletRequest request) {
		poli_code = poli_code.trim();
		
		List<PoliceBasic> police = policeService.getPolice(poli_code);
		int resultCode =0;
		Map<String, Object> resultMap = new HashMap<String, Object>(2);
		if(police!=null&&police.size()==1){
			if(police.get(0).getPoliPass().equals("pwd123")){
				if(police.get(0).getIsDeleted()==false){
					Police police2= new Police();
					police2.setPoliId(police.get(0).getPoliId());
					police2.setIpLastlogin("123213");
					police2.setTimeLastlogin(new Date());
					int updatePolice = policeService.updatePolice(police2);
					if (updatePolice==1) {
						resultCode=1;
						resultMap.put("police", police.get(0));
					}else{
						resultCode=4;
					}
					
				}else{
					resultCode=3;
				}
			}else{
				resultCode=2;
			}
		}
		resultMap.put("resultCode", resultCode);
		return JsonUtils.createGson().toJson(resultMap);
	}

//	@ResponseBody
//	@RequestMapping(value = "/police/login", method = RequestMethod.POST, produces = "text/html;charset=UTF-8")
//	
	
}
