//所长二级目录请求数据---派出所-->小区/独立建筑
function treeLevel20(stat_id_my){
	$.ajax({
		url:'../police_station/jurisdiction',
		type:'POST',
		data:{
			poli_station_id:stat_id_my,
		},
		success:function(data){
		 //console.log(data);
			var tree_datas = eval('('+data+')');
			var buildingbox = $('#menu1-ul');
		    buildingbox.html('');
		    var p = '';
		    for (var i = 0; i < tree_datas.community.length; i++) {
		        p += '<li class="building1" id="commId'+tree_datas.community[i].commId+'" ><a class="m0" href="javascript:void(0)" onclick="treeLevel21('+tree_datas.community[i].commId+');getStatisByComm('+tree_datas.community[i].commId+');return false;">'+tree_datas.community[i].commName+'</a><ul class="file" id="file'+tree_datas.community[i].commId+'"></ul></li>';
		        
		    }
		    for (var j = 0; j < tree_datas.building.length; j++) {
		        p += '<li class="building2" id="building'+tree_datas.building[j].builId+'"><a class="m1" href="javascript:void(0)" onclik="getStatisByBuil('+tree_datas.building[j].builId+');getUnit('+tree_datas.building[j].builId+')">'+tree_datas.building[j].builName+'</a></li>';
		    }

		    p += '</ul>';

		    buildingbox.append(p);

		    buildingbox.toggle();

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//所长三级目录请求数据----小区-->建筑
function treeLevel21(Comm_id_my){
	$.ajax({
		url:'../community/building',
		type:'POST',
		data:{
			comm_id:Comm_id_my,
		},
		success:function(data){
			//console.log(data);
			var datas = eval('('+data+')');
			// console.log(nodeId_my);
			
		    var buildingbox = $('#file'+Comm_id_my);
		    buildingbox.html('');
		    var p = '';
		    for (var i = 0; i < datas.building.length; i++) {
		        p += '<li class="building2" id="building'+datas.building[i].builId+'"><a href="javascript:void(0)" onclick="getStatisBybuild('+datas.building[i].builId+');getUnit('+datas.building[i].builId+')">'+datas.building[i].builName+'</a></li>';
		    }

		    buildingbox.prepend(p);

		    buildingbox.toggle();
			
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//一般警员一级目录数据请求---辖区建筑-->小区/独立建筑
function treeLevel10(poli_id_my){

	$.ajax({
		url:'../police/jurisdiction',
		type:'POST',
		data:{
			poli_id:poli_id_my,
		},
		success:function(data){
		 //console.log(data);
			var tree_datas = eval('('+data+')');
			var buildingbox = $('#menu1-ul');
		    buildingbox.html('');
		    var p = '';
		    for (var i = 0; i < tree_datas.community.length; i++) {
		        p += '<li class="building1" id="commId'+tree_datas.community[i].commId+'" ><a class="m0" href="javascript:void(0)" onclick="treeLevel21('+tree_datas.community[i].commId+');getStatisByComm('+tree_datas.community[i].commId+');return false;">'+tree_datas.community[i].commName+'</a><ul class="file" id="file'+tree_datas.community[i].commId+'"></ul></li>';
		        
		    }
		    for (var j = 0; j < tree_datas.building.length; j++) {
		        p += '<li class="building2" id="building'+tree_datas.building[j].builId+'"><a class="m1" href="javascript:void(0)" onclik="getStatisByBuil('+tree_datas.building[j].builId+');getUnit('+tree_datas.building[j].builId+')">'+tree_datas.building[j].builName+'</a></li>';
		    }

		    p += '</ul>';

		    buildingbox.append(p);

		    buildingbox.toggle();

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//警员二级目录数据请求----点击小区获取建筑
//调用treelevel20();
//统计信息---警员登录时加载全部统计信息
function getStatisByPoli(poli_id_my){
	$.ajax({
		url:'../police/jurisdiction/statistics',
		type:'POST',
		data:{
			poli_id:poli_id_my,
		},
		success:function(data){
		 //console.log(data);
			var datas = eval('('+data+')');
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> 所管辖区</li>'
			p += '<ul><li>小区数：'+datas.community_number+'</li><li>超期未巡检小区数：'+datas.over_due_community_number+'</li><li>重点关注小区数：'+datas.focus_community_number+'</li></ul>';
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);

			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//点击小区时，显示小区统计信息
function getStatisByComm(comm_id_my){
	var commName = $('#commId'+comm_id_my+">:first-child").text();
	$.ajax({
		url:'../community/statistics',
		type:'POST',
		data:{
			comm_id:comm_id_my,
		},
		success:function(data){
		 //console.log(data);
			var datas = eval('('+data+')');
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> '+commName+'</li>'
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);
			$('.charts').css({'display':'none'});
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//点击建筑 获取建筑统计信息
function getStatisBybuild(buil_id_my){
	var builName = $('#building'+buil_id_my+">:first-child").text();
	$.ajax({
		url:'../building/statistics',
		type:'POST',
		data:{
			buil_id:buil_id_my,
		},
		success:function(data){
			var datas = eval('('+data+')');
			//console.log(datas);
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> '+builName+'</li>'
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);
			$('.charts').css({'display':'none'});
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

function commchart(datas){
	var chart_data_comm = [];
	chart_data_comm.push({value:datas.indebuilding,name:'独立建筑'},
						{value:datas.building_number-datas.indebuilding,name:'小区建筑'});

	$('#chart1').css({display: 'block'});

	creatCharts('chart1',chart_data_comm,'楼宇/建筑统计:');
}

//统计信息---所长登录时加载全部统计信息
function getStatisByStat(stat_id_my){
	$.ajax({
		url:'../police_station/jurisdiction/statistics',
		type:'POST',
		data:{
			poli_station_id:stat_id_my,
		},
		success:function(data){
			var datas = eval('('+data+')');
			//console.log(datas);
			var statisticsBox = $('#info-t-box');
			statisticsBox.html('');
			var p = '';
			p += '<li class="info-t"><span class="icomoon">&#xe904;</span> 派出所辖区</li>'
			p += '<ul><li>警员数：'+datas.police_number+'</li></ul>'
			p += '<ul><li>小区数：'+datas.community_number+'</li><li>超期未巡检小区数：'+datas.over_due_community_number+'</li><li>重点关注小区数：'+datas.focus_community_number+'</li></ul>';
			p += '<ul><li>楼宇数：'+datas.building_number+'</li><li>超期未巡检楼宇数：'+datas.over_due_building_number+'</li><li>重点关注楼宇数：'+datas.focus_building_number+'</li></ul>';
			p += '<ul><li>房间总数：'+datas.room_number+'</li><li>空房间数：'+datas.empty_room_number+'</li><li>超期未巡检房间数：'+datas.over_due_room_number+'</li><li>重点关注房间数：'+datas.focus_room_number+'</li></ul>';
			p += '<ul><li>总人数'+datas.person_number+'</li><li>重点人数：'+datas.focus_person_number+'</li></ul>';

			statisticsBox.prepend(p);

			$('.charts').css({'display':'none'});
			commchart(datas);
			roomchart(datas);
			peoplechart(datas);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
//房间分类统计
function roomchart(datas){
	var chart_data_room = [];
	for (var i = 0; i < datas.room_classify_info.length; i++) {
		if(datas.room_classify_info[i].roomclass==01){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'住宅'}) ;	
		}else if(datas.room_classify_info[i].roomclass==02){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'特业'});
		}else if(datas.room_classify_info[i].roomclass==03){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'学校'});
		}else if(datas.room_classify_info[i].roomclass==04){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'场所'});
		}else if(datas.room_classify_info[i].roomclass==05){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'其他'});
		}else if(datas.room_classify_info[i].roomclass==06){
			chart_data_room.push({value:datas.room_classify_info[i].num, name:'重点关注'});
		}else{
			alert('数据有误！');
		}
		
	}
	$('#chart2').css({display: 'block'});

	creatCharts('chart2',chart_data_room,'房间分类统计:');
}
//人员居住原因统计
function peoplechart(datas){
	var chart_data_people = [];
	for (var i = 0; i < datas.person_classify_info.length; i++) {
		if (datas.person_classify_info[i].why==01) {
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'自住'});
		}else if (datas.person_classify_info[i].why==02) {
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'租住'});
		}else if (datas.person_classify_info[i].why==03){
			chart_data_people.push({value:datas.person_classify_info[i].num, name:'工作'});
		}else{
			alert('数据有误！');
		}
	}
	$('#chart3').css({display: 'block'});

	creatCharts('chart3',chart_data_people,'人员居住原因统计:');
}
//点击建筑获取单元信息
function getUnit(buil_id_my){
	$.ajax({
		url:'../building/unit',
		type:'POST',
		data:{
			buil_id:buil_id_my,
		},
		success:function(data){
			//console.log(data);
			var datas = eval('('+data+')');

			var tabbox = $('#myTab');
			tabbox.html('');
		    var p = '<li class="active"><a class="tab-d" href="#dy'+datas.unit[0]+'" data-toggle="tab">' + datas.unit[0] + '单元</a></li>';
		    for (var i = 1; i < datas.unit.length; i++) {
		        p += '<li><a class="tab-d" href="#dy'+datas.unit[i]+'" data-toggle="tab">' + datas.unit[i] + '单元</a></li>';

		    }
		    tabbox.prepend(p);
		    getfloor(buil_id_my,datas.unit[0]);
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}
// 根据建筑 和单元获取楼层信息
function getfloor(builId,unit){
	$.ajax({
		url:'../building/unit/floor',
		type:'POST',
		data:{
			buil_id:builId,
			unit_num:unit,
		},
		success:function(data){
			//console.log(data);
			var datas = eval('('+data+')');
			var floor_change = $('#floor-change');
			floor_change.html('');
			var p = '';
			p += '<li class="previous"><a id="lastfl" href="javascript:void(0)"><img src="images/lastfloor.png" alt="上"></a></li>';
			p += '<li class="floor-num">第&nbsp;&nbsp;<input class="floor-input" type="text" class="form-control input-sm" id="floor-num" value="1" placeholder="1" >&nbsp;&nbsp;层';
			p += '&nbsp;&nbsp;<a id="fl-go" class="btn btn-xs" href="javascript:void(0)"><img class="btn-go" src="images/btn-go.png" style="width:20px;height:20px;" alt="跳转"></a><span class="maxfloor red-2">（共'+datas.floor.length+'层）</span></li>';
			p += '<li class="next"><a id="nextfl" href="javascript:void(0)"><img src="images/nextfloor.png" alt="下"></a></li>';

			floor_change.prepend(p);

			getroom(builId,unit,datas.floor[0]);

			var floor_now = $('#floor-num').val(),
				minfl = datas.floor[0],
				maxfl = datas.floor[datas.floor.length-1];

			$('#lastfl').bind('click;', lastFloor(minfl,floor_now));
			$('#fl-go').bind('click;', gotoFloor(floor_now));
			$('#nextfl').bind('click;', nextFloor(maxfl,floor_now));
		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

//点击单元 获取楼层及房间信息
function getroom(builId,unit_num,floor_num){
	$.ajax({
		url:'../building/unit/floor/room',
		type:'POST',
		data:{
			buil_id:builId,
			unit_num:unit_num,
			floor_num:floor_num,
		},
		success:function(data){
		//console.log(data);
		var datas = eval('('+data+')');
		var roombox = $('#roombox');
		var q = '';
		roombox.html('');
		console.log(datas.room[0].personNum,datas.room.length)
		for (var i = 0; i < datas.room.length; i++) {
			// 有人 未超期 关注
        	if(datas.room[i].personNum>0 &&datas.room[i].isOverInspect && datas.room[i].isFocus){
            	q += '<button type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-danger">'+datas.room[i].personNum+'<span class="badge-my badge-danger">'+datas.room[i].roomNo+'</span></button>';
			}
			//有人 未超期 不关注
			else if(datas.room[i].personNum>0 &&datas.room[i].isOverInspect && !(datas.room[i].isFocus)){

            	q += '<button type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-success">'+datas.room[i].personNum+'<span class="badge-my badge-success">'+datas.room[i].roomNo+'</span></button>';
			}
	        //有人 超期 关注
	        else if(datas.room[i].personNum>0 &&!(datas.room[i].isOverInspect) && datas.room[i].isFocus){
	            q += '<button type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-danger">'+datas.room[i].personNum+'<span class="badge-my">'+datas.room[i].roomNo+'</span></button>';
			}
	        //有人 超期 不关注
	        else if(datas.room[i].personNum>0 &&!(datas.room[i].isOverInspect) && !(datas.room[i].isFocus)){
				q += '<button type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-success">'+datas.room[i].personNum+'<span class="badge-my">'+datas.room[i].roomNo+'</span></button>';
	        }
	        // 没人
	        else if(datas.room[i].personNum==0){
				q += '<button type="button" class="btn-h col-lg-2 col-md-2 col-xs-2 col-sm-2 btn btn-default">'+datas.room[i].personNum+'<span class="badge-my badge-success">'+datas.room[i].roomNo+'</span></button>';
			}
		}
		
		q += '</p>';

    	roombox.prepend(q);

		},
		error:function(err){
			alert('发生了错误：'+err.status);
			console.table(err);
		}
	});
}

// 切换到上一层
function lastFloor(minfl,flnow){
	// var flnow_my = flnow;
	// if(minfl<flnow_my){
	// 	flnow_my--;
	// 	$('#floor-num').
	// }
}
// 切换到下一层
function nextFloor(flnow){

}
// 切换到指定楼层
function gotoFloor(maxfl,flnow){

}