<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.hdu.lab.checkIn.mapper.InfoGetMapper">
	<!-- 获取超期信息 -->
	<select id="getOverData" parameterType="java.lang.Integer"
		resultMap="OverDataMap">
		select count(*) as room_overinspect,count(distinct c.COMM_ID) as
		comm_overinspect,
		count(distinct b.BUIL_ID) as buil_overinspect
		from community as c,building as b,room as r,sysparam as s
		where (c.POLI_ID = #{poliId,jdbcType=INTEGER}
		and c.COMM_ID = b.COMM_ID)
		or b.POLI_ID = #{poliId,jdbcType=INTEGER}
		and r.BUIL_ID=b.BUIL_ID
		and s.PARA_NAME="INSPECT_PERIOD"
		and to_days(now())-to_days(r.TIME_LASTINSPECT)>s.PARA_VALUE;
	</select>

	<resultMap type="edu.hdu.lab.checkIn.dto.OverData" id="OverDataMap">
		<result column="room_overinspect" property="room_overinspect"
			jdbcType="INTEGER" />
		<result column="buil_overinspect" property="buil_overinspect"
			jdbcType="INTEGER" />
		<result column="comm_overinspect" property="comm_overinspect"
			jdbcType="INTEGER" />
	</resultMap>
	
	<!-- 获取初始生成树 -->
	<!-- 通过警员id查询小区 -->
	<select id="getComm">
		select * from community 
		where POLI_ID="010001";
	</select>
	<!-- 通过警员id查询独立建筑-->
	<select id="getBuilByPoli">
		select * from building 
		where POLI_ID="010001";
	</select>
	
	<!-- 通过小区id查询建筑-->
	<select id="getBuilByComm">
		select * from building 
		where COMM_ID="010001";
	</select>
	
	
	<!-- 通过派出所编号id查询警员所管辖的所有小区-->
	<select id="getCommByOffi">
		select * from community as c,police as p
		where p.POLI_OFFICE = "0101"
		and POLI_ROLE="01";
		and c.POLI_ID=p.POLI_ID;
	</select>
	
	<!-- 通过派出所编号查询警员所管辖的独立建筑-->
	<select id="getbBuilByOffi">
		select * from building as b,police as p
		where p.POLI_OFFICE = "0101"
		and b.POLI_ID=p.POLI_ID;
	</select>
	
	<!-- 通过派出所编号查询警员所管辖的独立建筑-->
	<select id="getbBuilByOffi">
		select * from building as b,police as p
		where p.POLI_OFFICE = "0101"
		and b.POLI_ID=p.POLI_ID;
	</select>
	<!-- 通过build_id，统计所有room的信息-->
	<select id="ge">
	
	</select>

</mapper>