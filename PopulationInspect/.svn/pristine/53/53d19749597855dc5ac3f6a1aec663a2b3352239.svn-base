<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>巡检情况查询</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/people_info.css">
</head>
<body>
<nav class="navbar-my col-lg-12 col-md-12 col-xs-12 col-sm-12">
    <img class="logo-img" src="images/logo.png" alt="logo">
    <div class="navbar-header-my navbar-header ">
        <span class="logo">派出所住户地址登记查询系统</span>
    </div>

    <div class="logout" >
        <p class="navbar-icon navbar-text navbar-right text-right">
            <a href="index.html" class="navbar-link"><span class="icomoon">&#xe900;</span></a>
            <a href="#" class="navbar-link"><span class="icomoon">&#xe905;</span></a>
            <a href="#" class="navbar-link"><span class="icomoon">&#xe908;</span></a>
            <a href="login.html" class="navbar-link"><span class="icomoon">&#xe90b;</span></a>
        </p>
        <div id="admin" class="admin pull-right"></div>
    </div><!-- /.navbar-collapse -->
</nav>

<div class="main2">
    <div class="col-lg-8 col-md-8 col-lg-offset-2 col-md-offset-2">
        <div class="plot">
            <div id="plot" class="plot-chart col-lg-5 col-md-5"></div>
            <div id="plot-info" class="plot-info col-lg-7 col-md-7">
            <p>超期未巡检小区列表</p>
                <ul class="plot-check-log list-unstyled" id="comm-overdue">
                    <!-- <li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span>小区名称</li> -->
                </ul>
                        <p>即将超期未巡检小区列表</p>
                <ul class="plot-check-log list-unstyled" id="comm-overdue2">
                </ul>

            </div>
        </div>
        <div class="building">
            <div id="building" class="building-chart col-lg-5 col-md-5"></div>
            <div id="building-info" class="building-info col-lg-7 col-md-7">
                <p>超期未巡检建筑列表</p>
                <ul class="building-check-log list-unstyled" id="build-overdue">
                    <!-- <li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span>楼宇名称</li> -->
                </ul>
                <p>即将超期未巡检建筑列表</p>
                 <ul class="building-check-log list-unstyled" id="build-overdue2">
                    
                </ul>

            </div>

        </div>
        <div class="house-c">
            <div id="house-c" class="house-chart col-lg-5 col-md-5"></div>
            <div class="house-c-info col-lg-7 col-md-7">
                 <p id="overdue-room">超期未巡检房间列表</p>
                <table id="room-overdue" class="table table-hover">
                <thead id="room-thead"></thead>
                <tbody id="room-tbody"></tbody>
                </table>
                <div id="overdueRoom-button">
                </div>
                 <p id="overdue-room2">即将超期未巡检房间列表</p>
                <table id="room-overdue2" class="table table-hover">
                <thead id="room-thead2"></thead>
                <tbody id="room-tbody2"></tbody>
                </table>
                <div id="overdueRoom-button2">
                </div>
        

            </div>
        </div>
    </div>
</div>

</body>
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.table2excel.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/main.js"></script>
<script src="js/police.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var datas = JSON.parse(storage.getItem('police-info'));
        var poli_id_my = datas.police.poliId;
        admin();

        getOverDueCom(poli_id_my);


        
    });

function getOverDueCom(poli_id_my){
    $.ajax({
        url: '../overInfo/OverDate',
        type: 'POST',
        data: {
            poli_id: poli_id_my,
        },
        success:function(data){
            // console.log(data);
            var datas = eval('('+data+')');

            commchart(datas);
            buildchart(datas);
            roomchart(datas);

            commlist(datas);
            buildlist(datas);
            roomlist(datas);
            
        },
        error:function(err){
        alert('发生了错误：'+err.status);
        console.table(err);
        }
    });
}

function commchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_community_number, name:'未巡检小区'});
    chart_data.push({value:datas.community_number-datas.over_due_community_number, name:'已巡检小区'});
    chart_data.push({value:datas.quick_over_due_community.length,name:'即将超期未巡检小区'});
        
    creatCharts('plot',chart_data,'小区巡检情况:');
}

function buildchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_building_number, name:'未巡检建筑'});
    chart_data.push({value:datas.building_number-datas.over_due_building_number, name:'已巡检建筑'});
    chart_data.push({value:datas.quick_over_due_building.length,name:'即将超期未巡检建筑'});

    creatCharts('building',chart_data,'建筑巡检情况:');
}

function roomchart(datas){
    var chart_data = [];
    
    chart_data.push({value:datas.over_due_room_num, name:'未巡检房间'});
    chart_data.push({value:datas.room_num-datas.over_due_room_num, name:'已巡检房间'});
    chart_data.push({value:datas.quick_over_due_room.length,name:'即将超期未巡检房间'});

    creatCharts('house-c',chart_data,'房间巡检情况:');
}

function commlist(datas){
    var commbox = $('#comm-overdue');
    commbox.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_community.length; i++) {

        getCommName(datas.over_due_community[i].commId,i);

        p += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue'+i+'"></span></li>'
    }

    commbox.prepend(p);
    var commbox1 = $('#comm-overdue2');
       commbox1.html('');
    var p1 = '';
    for (var i = 0; i < datas.quick_over_due_community.length; i++) {

        getCommName2(datas.quick_over_due_community[i].commId,i);

        p1 += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue2'+i+'"></span></li>'
    }

    commbox1.prepend(p1);
}
function buildlist(datas){
    var buildbox = $('#build-overdue');
    buildbox.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_building.length; i++) {

        getCommName(datas.over_due_building[i].commId,-i-1);
        getBuildName(datas.over_due_building[i].builId,i);

        p += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue'+(-i-1)+'"></span>&nbsp;&nbsp;'+datas.over_due_building[i].builName+'</li>'
    }

    buildbox.prepend(p);
    var buildbox1 = $('#build-overdue2');
    buildbox1.html('');
    var p1 = '';
    for (var i = 0; i < datas.quick_over_due_building.length; i++) {

        getCommName2(datas.quick_over_due_building[i].commId,-i-1);
        getBuildName2(datas.quick_over_due_building[i].builId,i);

        p1 += '<li class="list-group-item-danger"><span class="icomoon">&#xe90e;</span><span id="commName-overdue2'+(-i-1)+'"></span>&nbsp;&nbsp;'+datas.quick_over_due_building[i].builName+'</li>'
    }

    buildbox1.prepend(p1);
}
function roomlist(datas){
    var roomthead = $('#room-thead');
    var head = '<tr><th>小区</th><th>建筑</th><th>单元</th><th>房间号</th></tr>';
        roomthead.html(head);
    var roomtbody = $('#room-tbody');
        roomtbody.html('');
    var p = '';
    for (var i = 0; i < datas.over_due_room.length; i++) {
         //console.log("getBuildName");
        p += '<tr class="list-group-item-danger"><td id="commName-overdue'+('-'+i+'-'+i)+'"></td><td id="builName-overdue'+i+'"></td><td>'+datas.over_due_room[i].roomUnit+'单元</td><td>'+datas.over_due_room[i].roomNo+'</td>';
             getBuildName(datas.over_due_room[i].builId,i);

    }
   

    roomtbody.prepend(p);
    if(p == ''){
        roomthead.html("");
    }
    var overdueRoom = $("#overdueRoom-button");
        overdueRoom.html("");
        var overdueRoomp = "";
        if(p != ''){
             overdueRoomp += '<button class="btn btn-info btn-left" type="button" onclick="confirmExcel1()">'+
                '导出详情到excel表</button>';
        }
        overdueRoom.append(overdueRoomp);

        // 即将超期未巡检列表
        var roomthead2 = $('#room-thead2');
    var head2 = '<tr><th>小区</th><th>建筑</th><th>单元</th><th>房间号</th></tr>';
        roomthead2.html(head2);
    var roomtbody2 = $('#room-tbody2');
        roomtbody2.html('');
    var p2 = '';
    for (var i = 0; i < datas.quick_over_due_room.length; i++) {
         //console.log("getBuildName");
        p2 += '<tr class="list-group-item-danger"><td id="commName-overdue2'+('-'+i+'-'+i)+'"></td><td id="builName-overdue2'+i+'"></td><td>'+datas.quick_over_due_room[i].roomUnit+'单元</td><td>'+datas.quick_over_due_room[i].roomNo+'</td>';
             getBuildName2(datas.quick_over_due_room[i].builId,i);

    }
    roomtbody2.prepend(p2);
    if(p2 == ''){
        roomthead2.html("");
    }
    var overdueRoom2 = $("#overdueRoom-button2");
        overdueRoom2.html("");
        var overdueRoomp2 = "";
        if(p2 != ''){
             overdueRoomp2 += '<button class="btn btn-info btn-left" type="button" onclick="confirmExcel2()">'+
                '导出详情到excel表</button>';
        }

        overdueRoom2.append(overdueRoomp2);
    
  
}
function confirmExcel1(){
    var message = confirm("确定导出数据到excel表吗？");
    if(message == true){
        excel1();
    }
}
function excel1(){
            var time = new Date();
            var year = time.getFullYear();
            var month = time.getMonth()+1;
            var day = time.getDate();
            var hour = time.getHours();
            var minute = time.getMinutes();
            var second = time.getSeconds();
         var title = $("#overdue-room").html()+ "  " + year + "-" + month + 
                "-" + day +" " + hour + "\:" + minute + "\:" + second;
         $("#room-overdue").table2excel({
                  exclude: ".noExl",
                    name: "Excel Document Name",
                    filename: title,
                    exclude_img: true,
                    exclude_links: true,
                    exclude_inputs: true
              });
}
function confirmExcel2(){
    var message = confirm("确定导出数据到excel表吗？");
    if(message == true){
        excel2();
    }
}
function excel2(){
            var time = new Date();
            var year = time.getFullYear();
            var month = time.getMonth()+1;
            var day = time.getDate();
            var hour = time.getHours();
            var minute = time.getMinutes();
            var second = time.getSeconds();
         var title = $("#overdue-room2").html()+ "  " + year + "-" + month + 
                "-" + day +" " + hour + "\:" + minute + "\:" + second;
         $("#room-overdue2").table2excel({
                  exclude: ".noExl",
                    name: "Excel Document Name",
                    filename: title,
                    exclude_img: true,
                    exclude_links: true,
                    exclude_inputs: true
              });
}
</script>
</html>